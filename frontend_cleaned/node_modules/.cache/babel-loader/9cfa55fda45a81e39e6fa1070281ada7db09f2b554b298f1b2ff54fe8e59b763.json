{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\admin\\\\Desktop\\\\chatbot\\\\frontend_cleaned\\\\src\\\\components\\\\Chat\\\\ChatInterface.tsx\",\n  _s = $RefreshSig$();\n// src/components/Chat/ChatInterface.tsx\nimport React, { useEffect, useState } from \"react\";\nimport { chatWithAgent, getChatHistory } from \"../../api/chatApi\";\nimport { listPrompts } from \"../../api/promptApi\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatInterface = ({\n  projectId\n}) => {\n  _s();\n  var _selectedPrompt$id;\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [prompts, setPrompts] = useState([]);\n  const [selectedPrompt, setSelectedPrompt] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const fetchHistory = async () => {\n    try {\n      const data = await getChatHistory(projectId);\n      setMessages((data || []).map(m => {\n        var _m$userMessage, _m$botMessage;\n        return {\n          userMsg: (_m$userMessage = m.userMessage) !== null && _m$userMessage !== void 0 ? _m$userMessage : \"\",\n          botMsg: (_m$botMessage = m.botMessage) !== null && _m$botMessage !== void 0 ? _m$botMessage : \"\"\n        };\n      }));\n    } catch (err) {\n      console.error(\"get history\", err);\n    }\n  };\n  const fetchPrompts = async () => {\n    try {\n      const data = await listPrompts(projectId);\n      setPrompts(data || []);\n    } catch (err) {\n      console.error(\"list prompts\", err);\n    }\n  };\n  useEffect(() => {\n    if (!projectId) return;\n    fetchHistory();\n    fetchPrompts();\n  }, [projectId]);\n  const handleSend = async () => {\n    if (!input) return;\n    setLoading(true);\n    try {\n      const resp = await chatWithAgent(projectId, input, selectedPrompt === null || selectedPrompt === void 0 ? void 0 : selectedPrompt.id);\n      setMessages([...messages, {\n        userMsg: input,\n        botMsg: resp.response\n      }]);\n      setInput(\"\");\n    } catch (err) {\n      console.error(\"chat error\", err);\n      setMessages([...messages, {\n        userMsg: input,\n        botMsg: \"Error: failed to get reply\"\n      }]);\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-3 border rounded bg-white\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"mr-2\",\n        children: \"Prompt:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: (_selectedPrompt$id = selectedPrompt === null || selectedPrompt === void 0 ? void 0 : selectedPrompt.id) !== null && _selectedPrompt$id !== void 0 ? _selectedPrompt$id : \"\",\n        onChange: e => {\n          var _prompts$find;\n          const id = e.target.value ? parseInt(e.target.value) : undefined;\n          setSelectedPrompt((_prompts$find = prompts.find(p => p.id === id)) !== null && _prompts$find !== void 0 ? _prompts$find : null);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"(none)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 11\n        }, this), prompts.map(p => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: p.id,\n          children: p.name\n        }, p.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 29\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-64 overflow-y-auto mb-3 p-2 border bg-gray-50\",\n      children: messages.map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"You:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 18\n          }, this), \" \", m.userMsg]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-blue-800\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Bot:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 44\n          }, this), \" \", m.botMsg]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, this)]\n      }, i, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"flex-1 border p-2 rounded\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        placeholder: \"Type a message\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSend,\n        className: \"bg-indigo-600 text-white px-4 rounded\",\n        disabled: loading,\n        children: loading ? \"...\" : \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatInterface, \"aP8YnVEzr0u/1e5+5lughsfTrwA=\");\n_c = ChatInterface;\nexport default ChatInterface;\nvar _c;\n$RefreshReg$(_c, \"ChatInterface\");","map":{"version":3,"names":["React","useEffect","useState","chatWithAgent","getChatHistory","listPrompts","jsxDEV","_jsxDEV","ChatInterface","projectId","_s","_selectedPrompt$id","messages","setMessages","input","setInput","prompts","setPrompts","selectedPrompt","setSelectedPrompt","loading","setLoading","fetchHistory","data","map","m","_m$userMessage","_m$botMessage","userMsg","userMessage","botMsg","botMessage","err","console","error","fetchPrompts","handleSend","resp","id","response","className","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","_prompts$find","target","parseInt","undefined","find","p","name","i","placeholder","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Users/admin/Desktop/chatbot/frontend_cleaned/src/components/Chat/ChatInterface.tsx"],"sourcesContent":["// src/components/Chat/ChatInterface.tsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { chatWithAgent, getChatHistory } from \"../../api/chatApi\";\r\nimport { listPrompts } from \"../../api/promptApi\";\r\n\r\nconst ChatInterface: React.FC<{ projectId: number }> = ({ projectId }) => {\r\n  const [messages, setMessages] = useState<{ userMsg: string; botMsg: string }[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [prompts, setPrompts] = useState<any[]>([]);\r\n  const [selectedPrompt, setSelectedPrompt] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const fetchHistory = async () => {\r\n    try {\r\n      const data = await getChatHistory(projectId);\r\n      setMessages(\r\n        (data || []).map((m: any) => ({\r\n          userMsg: m.userMessage ?? \"\",\r\n          botMsg: m.botMessage ?? \"\",\r\n        }))\r\n      );\r\n    } catch (err) {\r\n      console.error(\"get history\", err);\r\n    }\r\n  };\r\n\r\n  const fetchPrompts = async () => {\r\n    try {\r\n      const data = await listPrompts(projectId);\r\n      setPrompts(data || []);\r\n    } catch (err) {\r\n      console.error(\"list prompts\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!projectId) return;\r\n    fetchHistory();\r\n    fetchPrompts();\r\n  }, [projectId]);\r\n\r\n  const handleSend = async () => {\r\n    if (!input) return;\r\n    setLoading(true);\r\n    try {\r\n      const resp = await chatWithAgent(projectId, input, selectedPrompt?.id);\r\n      setMessages([...messages, { userMsg: input, botMsg: resp.response }]);\r\n      setInput(\"\");\r\n    } catch (err) {\r\n      console.error(\"chat error\", err);\r\n      setMessages([...messages, { userMsg: input, botMsg: \"Error: failed to get reply\" }]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-3 border rounded bg-white\">\r\n      <div className=\"mb-2\">\r\n        <label className=\"mr-2\">Prompt:</label>\r\n        <select value={selectedPrompt?.id ?? \"\"} onChange={(e) => {\r\n          const id = e.target.value ? parseInt(e.target.value) : undefined;\r\n          setSelectedPrompt(prompts.find(p => p.id === id) ?? null);\r\n        }}>\r\n          <option value=\"\">(none)</option>\r\n          {prompts.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}\r\n        </select>\r\n      </div>\r\n\r\n      <div className=\"h-64 overflow-y-auto mb-3 p-2 border bg-gray-50\">\r\n        {messages.map((m, i) => (\r\n          <div key={i} className=\"mb-2\">\r\n            <div><strong>You:</strong> {m.userMsg}</div>\r\n            <div className=\"text-blue-800\"><strong>Bot:</strong> {m.botMsg}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"flex gap-2\">\r\n        <input className=\"flex-1 border p-2 rounded\" value={input} onChange={e => setInput(e.target.value)} placeholder=\"Type a message\" />\r\n        <button onClick={handleSend} className=\"bg-indigo-600 text-white px-4 rounded\" disabled={loading}>\r\n          {loading ? \"...\" : \"Send\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatInterface;\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,aAAa,EAAEC,cAAc,QAAQ,mBAAmB;AACjE,SAASC,WAAW,QAAQ,qBAAqB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAElD,MAAMC,aAA8C,GAAGA,CAAC;EAAEC;AAAU,CAAC,KAAK;EAAAC,EAAA;EAAA,IAAAC,kBAAA;EACxE,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGX,QAAQ,CAAwC,EAAE,CAAC;EACnF,MAAM,CAACY,KAAK,EAAEC,QAAQ,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACc,OAAO,EAAEC,UAAU,CAAC,GAAGf,QAAQ,CAAQ,EAAE,CAAC;EACjD,MAAM,CAACgB,cAAc,EAAEC,iBAAiB,CAAC,GAAGjB,QAAQ,CAAa,IAAI,CAAC;EACtE,MAAM,CAACkB,OAAO,EAAEC,UAAU,CAAC,GAAGnB,QAAQ,CAAC,KAAK,CAAC;EAE7C,MAAMoB,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACF,MAAMC,IAAI,GAAG,MAAMnB,cAAc,CAACK,SAAS,CAAC;MAC5CI,WAAW,CACT,CAACU,IAAI,IAAI,EAAE,EAAEC,GAAG,CAAEC,CAAM;QAAA,IAAAC,cAAA,EAAAC,aAAA;QAAA,OAAM;UAC5BC,OAAO,GAAAF,cAAA,GAAED,CAAC,CAACI,WAAW,cAAAH,cAAA,cAAAA,cAAA,GAAI,EAAE;UAC5BI,MAAM,GAAAH,aAAA,GAAEF,CAAC,CAACM,UAAU,cAAAJ,aAAA,cAAAA,aAAA,GAAI;QAC1B,CAAC;MAAA,CAAC,CACJ,CAAC;IACH,CAAC,CAAC,OAAOK,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAEF,GAAG,CAAC;IACnC;EACF,CAAC;EAED,MAAMG,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACF,MAAMZ,IAAI,GAAG,MAAMlB,WAAW,CAACI,SAAS,CAAC;MACzCQ,UAAU,CAACM,IAAI,IAAI,EAAE,CAAC;IACxB,CAAC,CAAC,OAAOS,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,cAAc,EAAEF,GAAG,CAAC;IACpC;EACF,CAAC;EAED/B,SAAS,CAAC,MAAM;IACd,IAAI,CAACQ,SAAS,EAAE;IAChBa,YAAY,CAAC,CAAC;IACda,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,CAAC1B,SAAS,CAAC,CAAC;EAEf,MAAM2B,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,IAAI,CAACtB,KAAK,EAAE;IACZO,UAAU,CAAC,IAAI,CAAC;IAChB,IAAI;MACF,MAAMgB,IAAI,GAAG,MAAMlC,aAAa,CAACM,SAAS,EAAEK,KAAK,EAAEI,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEoB,EAAE,CAAC;MACtEzB,WAAW,CAAC,CAAC,GAAGD,QAAQ,EAAE;QAAEgB,OAAO,EAAEd,KAAK;QAAEgB,MAAM,EAAEO,IAAI,CAACE;MAAS,CAAC,CAAC,CAAC;MACrExB,QAAQ,CAAC,EAAE,CAAC;IACd,CAAC,CAAC,OAAOiB,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,YAAY,EAAEF,GAAG,CAAC;MAChCnB,WAAW,CAAC,CAAC,GAAGD,QAAQ,EAAE;QAAEgB,OAAO,EAAEd,KAAK;QAAEgB,MAAM,EAAE;MAA6B,CAAC,CAAC,CAAC;IACtF,CAAC,SAAS;MACRT,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC;EAED,oBACEd,OAAA;IAAKiC,SAAS,EAAC,6BAA6B;IAAAC,QAAA,gBAC1ClC,OAAA;MAAKiC,SAAS,EAAC,MAAM;MAAAC,QAAA,gBACnBlC,OAAA;QAAOiC,SAAS,EAAC,MAAM;QAAAC,QAAA,EAAC;MAAO;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC,eACvCtC,OAAA;QAAQuC,KAAK,GAAAnC,kBAAA,GAAEO,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEoB,EAAE,cAAA3B,kBAAA,cAAAA,kBAAA,GAAI,EAAG;QAACoC,QAAQ,EAAGC,CAAC,IAAK;UAAA,IAAAC,aAAA;UACxD,MAAMX,EAAE,GAAGU,CAAC,CAACE,MAAM,CAACJ,KAAK,GAAGK,QAAQ,CAACH,CAAC,CAACE,MAAM,CAACJ,KAAK,CAAC,GAAGM,SAAS;UAChEjC,iBAAiB,EAAA8B,aAAA,GAACjC,OAAO,CAACqC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAChB,EAAE,KAAKA,EAAE,CAAC,cAAAW,aAAA,cAAAA,aAAA,GAAI,IAAI,CAAC;QAC3D,CAAE;QAAAR,QAAA,gBACAlC,OAAA;UAAQuC,KAAK,EAAC,EAAE;UAAAL,QAAA,EAAC;QAAM;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,EAC/B7B,OAAO,CAACQ,GAAG,CAAC8B,CAAC,iBAAI/C,OAAA;UAAmBuC,KAAK,EAAEQ,CAAC,CAAChB,EAAG;UAAAG,QAAA,EAAEa,CAAC,CAACC;QAAI,GAA1BD,CAAC,CAAChB,EAAE;UAAAI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAA+B,CAAC,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9D,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC,eAENtC,OAAA;MAAKiC,SAAS,EAAC,iDAAiD;MAAAC,QAAA,EAC7D7B,QAAQ,CAACY,GAAG,CAAC,CAACC,CAAC,EAAE+B,CAAC,kBACjBjD,OAAA;QAAaiC,SAAS,EAAC,MAAM;QAAAC,QAAA,gBAC3BlC,OAAA;UAAAkC,QAAA,gBAAKlC,OAAA;YAAAkC,QAAA,EAAQ;UAAI;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAACpB,CAAC,CAACG,OAAO;QAAA;UAAAc,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eAC5CtC,OAAA;UAAKiC,SAAS,EAAC,eAAe;UAAAC,QAAA,gBAAClC,OAAA;YAAAkC,QAAA,EAAQ;UAAI;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAACpB,CAAC,CAACK,MAAM;QAAA;UAAAY,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA,GAF7DW,CAAC;QAAAd,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAGN,CACN;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAENtC,OAAA;MAAKiC,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACzBlC,OAAA;QAAOiC,SAAS,EAAC,2BAA2B;QAACM,KAAK,EAAEhC,KAAM;QAACiC,QAAQ,EAAEC,CAAC,IAAIjC,QAAQ,CAACiC,CAAC,CAACE,MAAM,CAACJ,KAAK,CAAE;QAACW,WAAW,EAAC;MAAgB;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACnItC,OAAA;QAAQmD,OAAO,EAAEtB,UAAW;QAACI,SAAS,EAAC,uCAAuC;QAACmB,QAAQ,EAAEvC,OAAQ;QAAAqB,QAAA,EAC9FrB,OAAO,GAAG,KAAK,GAAG;MAAM;QAAAsB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACnB,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACnC,EAAA,CAjFIF,aAA8C;AAAAoD,EAAA,GAA9CpD,aAA8C;AAmFpD,eAAeA,aAAa;AAAC,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}